@page "/deployments/peaks"

@using Microsoft.AspNetCore.Authorization
@using SjaInNumbers.Client.Components
@using SjaInNumbers.Client.Converters
@using SjaInNumbers.Client.Services.Interfaces
@using SjaInNumbers.Shared.Model.Deployments

@inject IDeploymentService DeploymentService

@attribute [Authorize(Policy = "Lead")]

<PageTitle>SJA In Numbers - Peak Deployments</PageTitle>

<GeneralErrorHandler>
    <h2>Peak Deployments</h2>
    <BackLink Url="/deployments" />

    <table>
        <thead>
            <tr>
                <th>District</th>
                <th>Front-Line</th>
                <th>AWD</th>
                <th>4x4</th>
            </tr>
        </thead>
        @foreach (var region in peaks.GroupBy(p => p.Region).Where(r => r.Key != Shared.Model.Region.Undefined))
        {
            <thead>
                <tr>
                    <th colspan="4">@LabelConverters.LabelToDisplay(region.Key)</th>
                </tr>
            </thead>

            <tbody>
                @foreach (var district in region.OrderBy(d => d.District))
                {
                    <tr>
                        <td>@district.District</td>
                        <td>@district.FrontLineAmbulances</td>
                        <td>@district.AllWheelDriveAmbulances</td>
                        <td>@district.OffRoadAmbulances</td>
                    </tr>
                }
            </tbody>
        }
    </table>
</GeneralErrorHandler>

@code {
    private IList<PeakLoads> peaks = [];

    override protected async Task OnInitializedAsync()
    {
        peaks = await DeploymentService.GetPeakLoads().ToListAsync();
    }
}